\section{Theory}

The conventional imaging condition (CIC), first proposed by ~\cite{claerbout:467}
is a zero lag cross-correlation of the downgoing source wavefield with the upgoing 
receiver wavefield along the propagation time:

\beq
R(\xx)=\sum_{shots} \sum_{time} \US(\xx,t)\UR(\xx,t),
\label{eq:cic}
\eeq

this equation was developed in the ``exploding reflectors" context, which honors
the single scattering or Born concept. Under this idea, the source
wavefield interacts with the medium and generates scattered data recorded by
the receiver wavefields, therefore the source wavefield only contains transmitted
energy. 

In RTM when a sharp property contrast is present in the model, transmitted and reflected energy will
be generated during the wavefield extrapolation, producing backscattered energy in both
source and receiver wavefields. If that is the case, we can write the
source wavefield as

\beq
\US(\xx,t)= \USr(\xx,t) +\USt(\xx,t),
\label{eq:ssplit}
\eeq

where $^r$ stands for reflected and $^t$ stands for transmitted wavefield. Under this convention diving
waves and head waves would be considered as transmitted, therefore we can focus on the reflections coming
from sharp boundaries.

The same idea is applied to the receiver wavefield:

\beq
\UR(\xx,t)= \URr(\xx,t) +\URt(\xx,t).
\label{eq:rsplit}
\eeq

By doing this consideration, and by taking advantage of the linearity of equation ~\ref{eq:cic}  we
can split the CIC as follows:

\beq
R(\xx)= R^{tt}(\xx)+R^{rt}(\xx)+ R^{tr}(\xx) +R^{rr}(\xx).
\label{eq:cicsplit}
\eeq

We can consider as well the extended imaging condition~\cite[]{sava:S209}:

\beq
R(\xx,\tau,{\hh})= \sum_{shots} \sum_{t} \US({\xx} - {\hh},t-\tau) \UR(\xx+\hh,t+\tau).
\eeq

Under the presence of strong properties contrast, we can apply the same reasoning of equation ~\ref{eq:cicsplit} to 
the EIC:

\beq
R(\xx,\tau,\hh)= R^{tt}(\xx,\tau,\hh) +R^{rt}(\xx,\tau,\hh)+R^{tr}(\xx,\tau,\hh)+R^{rr}(\xx,\tau,\hh)
\label{eq:eicsplit}
\eeq


\subsection{Understanding the backscattered events}

To explain the construction of these events, we use a very simple 2D two layers model. The migrated image of the synthetic
data is shown in ~\rfg{img05_ref}, please note the strong low wavenumber events above the reflector. 

In figure 2 we show the RTM imaging process for this data. We can see in the first column of figure 2 how in the first
 150ms we build backscattered events only, these correspond to the cross-correlation between the downgoing source wavefield
 with the reflected (backscattered) receiver wavefield, $R^{tr}(\xx)$ according with our convention in 
 equation ~\ref{eq:cicsplit}. In this case the backscattered energy maps toward the source location. When 
the source wavefield reflects in the interface (column 2 of figure 2) we have  both $\USr$ and $\USt$ which produces 
the reflector image $R^{tt}(\xx)$ and new backscattered events given by the combination $R^{rt}(\xx)$. In the third 
column we only build backscattered events that correspond to the case $R^{rt}(\xx)$.
 In this case the backscattered energy moves toward the receiver array.

If we separate the source and receiver wavefields as stated in equations ~\ref{eq:ssplit} and ~\ref{eq:rsplit} we can perform
the imaging process separately as shown in equation ~\ref{eq:cicsplit}. By doing so, we obtain the individual contributions of each
case. In figure~\ref{fig:img05_nn} we see the cross-correlation between the transmitted wavefields $R^{tt}(\xx)$. In 
this case, and due to the simplicity of the model, this image should match perfectly with an image constructed by one-wave
equation migration. In figure ~\ref{fig:img05_nb} we show the  $R^{tr}(\xx)$ case, we can see again how the 
backscattered event images toward the source  location, this happens because the reflected receiver wavefield behaves
 as the transmitted source wavefield, and therefore both wavefields travels in perfect synchronization. In figure~\ref{fig:img05_bn}
we see the opposite: $R^{rt}(\xx)$, in this case the reflected source wavefield acts as the transmitted receiver
wavefield, producing backscattered events mapping toward the receivers. The last scenario $R^{rr}(\xx)$ shown
in figure~\ref{fig:img05_bb} produces an image which is in concordance with the geology as in figure~\ref{fig:img05_nn}. In this
case the source wavefield behaves as the receiver wavefield and vice versa, this can be seen as if we interchange the
order of the cross-correlation in the CIC (equation~\ref{eq:cic}).

\subsection{Mapping of the backscattered events in the extended images}

The extended imaging condition introduces an increase in the dimensionality of the image $R$, for the 2D case we change
2 dimensions $R(x,z)$ to 5 dimension $R(x,z,\lambda_x,\lambda_z,\tau)$, for the 3D case we introduce 4 extra dimensions. 
This makes it more costly if we do the extensions in all directions. We can choose to extend the image in one specific dimension.
Each extension provide some information about the accuracy of the velocity model, and could be used to transform the extended
image to angle gathers ~\citep{sava:S209,sava:S131}. 

We analyze the behaviour of the backscattered energy in each individual extension, and then look into combined extensions
in a given common image point (cip) location.

\subsubsection{Time-lag gathers}
In figure~\ref{fig:cit05_ref} we show a time-lag gather extracted in the center of the model. This gather has several events,
each of them correspond to one specific case of equation~\ref{eq:eicsplit}. Figure 4 shows how we can decompose figure~\ref{fig:cit05_ref} to get a better understanding of each event. We can see in figure~\ref{fig:cit05_nn} how the reflector is mapped in the 
time-lag gather, we see a change in the slope related to the abrupt change in velocity. Above the reflector depth the event has
a slope given by the upper medium velocity, whereas bellow the reflector depth the slope is given  the lower medium velocity.

\rFg{cit05_nb} shows the case $^{tr}$ in the time-lag gather. We see that the event maps to $\tau=0$, this means that the
reflected receiver wavefield $\URr$ travels in perfect synchronization with the transmitted source wavefield $\USt$ in the
upper layer. This way of mapping tells us that the velocity model in the upper layer is correct. \rFg{cit05_bn} shows
the contribution of the backscattered energy coming from the correlation between $\USr$ and $\URt$. We can see that it is mapped
again to $\tau=0$, overlaying with the $^{tr}$ case shown in \rfg{cit05_nb}. \rFg{cit05_nn} shows the case when the source wavefield
behaves as the receiver wavefield and vice versa, this is why it is mapped with a positive slope in the time-lag gather. The slope of
this event is exactly the opposite of the primary given by the velocity in the upper layer.

In time-lag gathers the correct imaged primary energy has to map close to zero lag, the same criteria applies 
to the backscattered events. These last ones might be easier to track since its correlation occur along the upper layer 
and not at one specific depth as with the primaries. 



\subsubsection{Space-lag gathers}

We show in figure~\ref{fig:citx05_ref} a space-lag gather in the $\lambda_x$ direction. In the space-lag gathers we need to see
a focused event in case of correct velocity. In this case the primary reflection overlays with the location of the 
backscattered events. We can follow the same flow as with the time-lag gathers. We show in ~\rfg{citx05_nn} the primary event focused
at the right location. In figures~\ref{fig:citx05_nb} and \ref{fig:citx05_bn} we see that the backscattered events maps as well toward
zero lag. This is something to expect since the image at space-lag has to be the same as the image at zero time-lag explained in
preious section. The event given by the combination $^{rr}$ in figure~\ref{fig:citx05_bb} shows some energy away zero-lag, this is
due to fact of the poor illumination given by the reflected wavefields, this happens because this wavefields only travel along
the first layer.

\subsubsection{Common image points}




%Is not clear what is the best strategy to split the wavefields into the reflected and transmitted energy. In this report
%we use a very simple approach taking advantage of a simple model. In more practical scenarios, and if needed we could
%use wavefield decomposition strategies in cit05_refthe Fourier domain, this is a common but costly strategy (i.e ~\cite{liu:S29},
% ~\cite{fei:3130}).
